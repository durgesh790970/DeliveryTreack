<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TiffinRush Voice Assistant</title>
  {% load static %}
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Poppins', sans-serif; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
      min-height: 100vh; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      padding: 20px;
    }
    
    .voice-container { 
      background: white; 
      border-radius: 30px; 
      padding: 40px; 
      box-shadow: 0 20px 60px rgba(0,0,0,0.15); 
      max-width: 500px; 
      width: 100%; 
      text-align: center;
    }
    
    /* Logo */
    .voice-logo { 
      display: inline-flex; 
      align-items: center; 
      gap: 12px; 
      padding: 12px 20px; 
      background: linear-gradient(135deg, #ff6b35 0%, #4caf50 100%); 
      border-radius: 40px; 
      margin-bottom: 30px; 
      box-shadow: 0 8px 25px rgba(255,107,53,0.3);
    }
    
    .voice-logo-icon { 
      width: 35px; 
      height: 35px; 
      background: white; 
      border-radius: 50%; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      font-size: 18px;
    }
    
    .voice-logo-text { 
      font-size: 20px; 
      font-weight: 700; 
      color: white; 
      text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
    }
    
    /* Voice Assistant Interface */
    .voice-title { 
      font-size: 28px; 
      font-weight: 700; 
      color: #333; 
      margin-bottom: 15px;
    }
    
    .voice-subtitle { 
      font-size: 16px; 
      color: #666; 
      margin-bottom: 30px; 
      line-height: 1.5;
    }
    
    /* Microphone Button */
    .mic-button { 
      width: 120px; 
      height: 120px; 
      border-radius: 50%; 
      border: none; 
      background: linear-gradient(135deg, #ff6b35 0%, #4caf50 100%); 
      color: white; 
      font-size: 40px; 
      cursor: pointer; 
      transition: all 0.3s; 
      box-shadow: 0 15px 40px rgba(255,107,53,0.3); 
      margin-bottom: 25px; 
      position: relative; 
      overflow: hidden;
    }
    
    .mic-button:hover { 
      transform: scale(1.1); 
      box-shadow: 0 20px 50px rgba(255,107,53,0.4);
    }
    
    .mic-button.listening { 
      animation: pulse 1.5s infinite; 
      background: linear-gradient(135deg, #4caf50 0%, #8bc34a 100%);
    }
    
    .mic-button.processing { 
      animation: spin 1s linear infinite; 
      background: linear-gradient(135deg, #2196f3 0%, #21cbf3 100%);
    }
    
    @keyframes pulse { 
      0% { transform: scale(1); box-shadow: 0 15px 40px rgba(76,175,80,0.3); } 
      50% { transform: scale(1.1); box-shadow: 0 20px 60px rgba(76,175,80,0.5); } 
      100% { transform: scale(1); box-shadow: 0 15px 40px rgba(76,175,80,0.3); } 
    }
    
    @keyframes spin { 
      from { transform: rotate(0deg); } 
      to { transform: rotate(360deg); } 
    }
    
    /* Status Messages */
    .voice-status { 
      font-size: 18px; 
      font-weight: 600; 
      margin-bottom: 20px; 
      min-height: 25px;
    }
    
    .status-waiting { color: #666; }
    .status-listening { color: #4caf50; }
    .status-processing { color: #2196f3; }
    .status-error { color: #f44336; }
    
    /* Voice Commands */
    .voice-commands { 
      background: #f8f9fa; 
      border-radius: 20px; 
      padding: 25px; 
      margin-top: 30px; 
      text-align: left;
    }
    
    .commands-title { 
      font-size: 18px; 
      font-weight: 700; 
      color: #333; 
      margin-bottom: 15px; 
      text-align: center;
    }
    
    .command-item { 
      display: flex; 
      align-items: center; 
      gap: 12px; 
      padding: 12px 0; 
      border-bottom: 1px solid #e0e0e0;
    }
    
    .command-item:last-child { border-bottom: none; }
    
    .command-icon { 
      width: 35px; 
      height: 35px; 
      background: linear-gradient(45deg, #ff6b35, #4caf50); 
      border-radius: 50%; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      font-size: 16px; 
      color: white;
    }
    
    .command-text { 
      flex: 1; 
      font-size: 14px; 
      color: #333; 
      font-weight: 500;
    }
    
    /* Response Display */
    .voice-response { 
      background: #e8f5e8; 
      border: 2px solid #4caf50; 
      border-radius: 15px; 
      padding: 20px; 
      margin-top: 20px; 
      display: none;
    }
    
    .response-title { 
      font-size: 16px; 
      font-weight: 700; 
      color: #2e7d32; 
      margin-bottom: 10px;
    }
    
    .response-text { 
      font-size: 14px; 
      color: #388e3c; 
      line-height: 1.4;
    }
    
    /* Browser Support Warning */
    .browser-warning { 
      background: #fff3cd; 
      border: 2px solid #ffc107; 
      border-radius: 15px; 
      padding: 15px; 
      margin-top: 20px; 
      display: none;
    }
    
    .warning-text { 
      font-size: 14px; 
      color: #856404; 
      font-weight: 500;
    }
    
    /* Waveform Animation */
    .voice-waveform { 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      gap: 3px; 
      height: 40px; 
      margin: 20px 0; 
      opacity: 0; 
      transition: opacity 0.3s;
    }
    
    .voice-waveform.active { 
      opacity: 1; 
    }
    
    .wave-bar { 
      width: 4px; 
      background: linear-gradient(to top, #ff6b35, #4caf50); 
      border-radius: 2px; 
      animation: wave 1s infinite ease-in-out;
    }
    
    .wave-bar:nth-child(2) { animation-delay: 0.1s; }
    .wave-bar:nth-child(3) { animation-delay: 0.2s; }
    .wave-bar:nth-child(4) { animation-delay: 0.3s; }
    .wave-bar:nth-child(5) { animation-delay: 0.4s; }
    
    @keyframes wave { 
      0%, 40%, 100% { height: 10px; } 
      20% { height: 30px; } 
    }
  </style>
</head>
<body>
  <div class="voice-container">
    <!-- Logo -->
    <div class="voice-logo">
      <div class="voice-logo-icon">üçΩÔ∏è</div>
      <div class="voice-logo-text">TiffinRush</div>
    </div>
    
    <!-- Title -->
    <h1 class="voice-title">üé§ Voice Assistant</h1>
    <p class="voice-subtitle">
      Hi! What would you like to eat today? Tap the microphone and tell me your craving!
    </p>
    
    <!-- Microphone Button -->
    <button class="mic-button" id="micButton" onclick="toggleVoiceRecording()">
      üé§
    </button>
    
    <!-- Status -->
    <div class="voice-status status-waiting" id="voiceStatus">
      Tap the microphone to start
    </div>
    
    <!-- Waveform Animation -->
    <div class="voice-waveform" id="waveform">
      <div class="wave-bar"></div>
      <div class="wave-bar"></div>
      <div class="wave-bar"></div>
      <div class="wave-bar"></div>
      <div class="wave-bar"></div>
    </div>
    
    <!-- Response Display -->
    <div class="voice-response" id="voiceResponse">
      <div class="response-title">ü§ñ Assistant Response:</div>
      <div class="response-text" id="responseText"></div>
    </div>
    
    <!-- Browser Warning -->
    <div class="browser-warning" id="browserWarning">
      <div class="warning-text">
        ‚ö†Ô∏è Voice recognition is not supported in your browser. Please use Chrome, Edge, or Safari for the best experience.
      </div>
    </div>
    
    <!-- Voice Commands Guide -->
    <div class="voice-commands">
      <h3 class="commands-title">üí¨ Try saying things like:</h3>
      
      <div class="command-item">
        <div class="command-icon">üçõ</div>
        <div class="command-text">"Order a chicken biryani"</div>
      </div>
      
      <div class="command-item">
        <div class="command-icon">üçï</div>
        <div class="command-text">"Show me pizza options"</div>
      </div>
      
      <div class="command-item">
        <div class="command-icon">‚≠ê</div>
        <div class="command-text">"Show me top-rated Chinese food nearby"</div>
      </div>
      
      <div class="command-item">
        <div class="command-icon">ü•ò</div>
        <div class="command-text">"I want spicy Indian food"</div>
      </div>
      
      <div class="command-item">
        <div class="command-icon">üçî</div>
        <div class="command-text">"Find burgers under 200 rupees"</div>
      </div>
      
      <div class="command-item">
        <div class="command-icon">üöö</div>
        <div class="command-text">"Track my order"</div>
      </div>
      
      <div class="command-item">
        <div class="command-icon">‚ù§Ô∏è</div>
        <div class="command-text">"Show my favorite restaurants"</div>
      </div>
      
      <div class="command-item">
        <div class="command-icon">üõí</div>
        <div class="command-text">"What's in my cart?"</div>
      </div>
    </div>
  </div>

  <script>
    let recognition = null;
    let isListening = false;
    
    // Initialize Speech Recognition
    function initializeSpeechRecognition() {
      if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = 'en-IN'; // Indian English
        
        recognition.onstart = function() {
          isListening = true;
          updateStatus('Listening...', 'listening');
          document.getElementById('micButton').classList.add('listening');
          document.getElementById('waveform').classList.add('active');
        };
        
        recognition.onresult = function(event) {
          const transcript = event.results[0][0].transcript;
          processVoiceCommand(transcript);
        };
        
        recognition.onerror = function(event) {
          console.error('Speech recognition error:', event.error);
          updateStatus('Sorry, I didn\'t catch that. Please try again.', 'error');
          resetMicrophone();
        };
        
        recognition.onend = function() {
          resetMicrophone();
        };
        
        return true;
      } else {
        document.getElementById('browserWarning').style.display = 'block';
        return false;
      }
    }
    
    // Toggle Voice Recording
    function toggleVoiceRecording() {
      if (!recognition) {
        if (!initializeSpeechRecognition()) {
          return;
        }
      }
      
      if (isListening) {
        recognition.stop();
        resetMicrophone();
      } else {
        recognition.start();
      }
    }
    
    // Update Status
    function updateStatus(message, type) {
      const statusElement = document.getElementById('voiceStatus');
      statusElement.textContent = message;
      statusElement.className = `voice-status status-${type}`;
    }
    
    // Reset Microphone
    function resetMicrophone() {
      isListening = false;
      document.getElementById('micButton').classList.remove('listening', 'processing');
      document.getElementById('waveform').classList.remove('active');
      
      setTimeout(() => {
        updateStatus('Tap the microphone to start', 'waiting');
      }, 1000);
    }
    
    // Process Voice Command
    function processVoiceCommand(command) {
      updateStatus('Processing your request...', 'processing');
      document.getElementById('micButton').classList.remove('listening');
      document.getElementById('micButton').classList.add('processing');
      document.getElementById('waveform').classList.remove('active');
      
      // Simulate processing time
      setTimeout(() => {
        const response = generateResponse(command.toLowerCase());
        showResponse(response);
        resetMicrophone();
      }, 2000);
    }
    
    // Generate Response
    function generateResponse(command) {
      const responses = {
        'biryani': {
          text: "Great choice! I found 12 biryani options nearby. The top-rated is 'Biryani Express' with chicken biryani for ‚Çπ299. Would you like me to add it to your cart?",
          action: () => window.location.href = '/menu/?search=biryani'
        },
        'pizza': {
          text: "Perfect! I found 8 pizza places near you. 'Domino's Pizza' has a special offer - 30% off on all pizzas! Their Margherita is highly rated.",
          action: () => window.location.href = '/menu/?search=pizza'
        },
        'chinese': {
          text: "Excellent! Top-rated Chinese restaurants: 1) Wow! China (4.5‚≠ê) - Hakka noodles ‚Çπ180, 2) Dragon Palace (4.3‚≠ê) - Sweet & sour chicken ‚Çπ220. Which sounds good?",
          action: () => window.location.href = '/menu/?search=chinese'
        },
        'burger': {
          text: "I found 6 burger joints with great deals! Burger King has burgers under ‚Çπ200 with 50% off. McDonald's also has a value menu starting at ‚Çπ99.",
          action: () => window.location.href = '/menu/?search=burger'
        },
        'track': {
          text: "Let me check your order status... Your last order (#FE12345) is out for delivery! Expected arrival: 15-20 minutes. The delivery partner is Raj.",
          action: () => window.location.href = '/track/'
        },
        'cart': {
          text: "You have 3 items in your cart: Margherita Pizza (‚Çπ299), Chicken Biryani (‚Çπ399), and Coke (‚Çπ50). Total: ‚Çπ748. Ready to checkout?",
          action: () => window.location.href = '/cart/'
        },
        'favorites': {
          text: "Your favorite restaurants: 1) Biryani Express (ordered 8 times), 2) Pizza Hut (ordered 5 times), 3) Burger King (ordered 4 times). Which one today?",
          action: () => window.location.href = '/restaurants/?filter=favorites'
        },
        'spicy': {
          text: "Craving something spicy! I recommend: Andhra Spice Kitchen (extra spicy chicken curry ‚Çπ280), or Punjabi Dhaba (spicy butter chicken ‚Çπ320). Both are üå∂Ô∏èüå∂Ô∏èüå∂Ô∏è level!",
          action: () => window.location.href = '/menu/?filter=spicy'
        }
      };
      
      // Find matching response
      for (let keyword in responses) {
        if (command.includes(keyword)) {
          return responses[keyword];
        }
      }
      
      // Default response
      return {
        text: `I heard: "${command}". I can help you find food, track orders, or manage your cart. Try saying "show me pizza options" or "track my order".`,
        action: () => window.location.href = '/menu/'
      };
    }
    
    // Show Response
    function showResponse(response) {
      const responseElement = document.getElementById('voiceResponse');
      const responseText = document.getElementById('responseText');
      
      responseText.innerHTML = response.text;
      responseElement.style.display = 'block';
      
      // Auto-execute action after 5 seconds
      setTimeout(() => {
        if (response.action) {
          response.action();
        }
      }, 5000);
    }
    
    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      // Check if speech recognition is supported
      if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) {
        document.getElementById('browserWarning').style.display = 'block';
      }
    });
    
    // Keyboard shortcut - Space bar to activate voice
    document.addEventListener('keydown', function(e) {
      if (e.code === 'Space' && !isListening) {
        e.preventDefault();
        toggleVoiceRecording();
      }
    });
    
    // Add voice prompts for better UX
    const voicePrompts = [
      "What's your food mood today?",
      "Hungry? Tell me what you're craving!",
      "Ready to order? Just speak your wish!",
      "What delicious food can I find for you?",
      "Feeling hungry? Let's find something tasty!"
    ];
    
    // Change prompt every 10 seconds when not active
    setInterval(() => {
      if (!isListening && document.getElementById('voiceStatus').textContent === 'Tap the microphone to start') {
        const randomPrompt = voicePrompts[Math.floor(Math.random() * voicePrompts.length)];
        updateStatus(randomPrompt, 'waiting');
      }
    }, 10000);
  </script>
</body>
</html>
